Run FTLs with Code Caches as part of tests
Follow up from #1842.

Also make sure caching passes the smc tests and handles anonymous fds, etc.