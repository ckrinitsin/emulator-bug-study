permissions: 0.764
peripherals: 0.722
risc-v: 0.705
user-level: 0.690
device: 0.642
ppc: 0.641
mistranslation: 0.640
register: 0.638
virtual: 0.635
vnc: 0.631
architecture: 0.618
files: 0.606
hypervisor: 0.603
TCG: 0.601
semantic: 0.596
boot: 0.594
debug: 0.589
performance: 0.589
KVM: 0.578
VMM: 0.578
arm: 0.547
PID: 0.547
x86: 0.547
assembly: 0.545
socket: 0.539
graphic: 0.526
network: 0.524
kernel: 0.436
i386: 0.392

vvfat core dump when enabling RW

Hi guys,

I'm getting this qemu crash message:
>>> qemu-system-x86_64: /build/qemu-TziMIO/qemu-2.5+dfsg/block/vvfat.c:2290: commit_direntries: Assertion `!strncmp(s->directory.pointer, "QEMU", 4)' failed.
>>> Aborted (core dumped)
when launching qemu with this options for a VVFAT drive:
>>> -drive file=fat:rw:./ROOT,if=virtio
(same happens when using cache=none and/or if=ide)

"uname -a" system info is:
>>> Linux RJZ-WRK-LNX 4.4.0-72-generic #93-Ubuntu SMP Fri Mar 31 14:07:41 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux
and "qemu --version" is:
>>> QEMU emulator version 2.5.0 (Debian 1:2.5+dfsg-5ubuntu10.10), Copyright (c) 2003-2008 Fabrice Bellard

Not sure what logs to attach but I'll be glad to upload whatever needed.

Thanks in advance for you help,
Rolando

Moving to QEMU-Ubuntu since you're not using upstream QEMU (and the bug should have been fixed there as pointed out by Hervé on the qemu-devel mailing list).

The mentioned commit is:

commit ebb72c9f066e5f85259e1541a6d3fb5bfd6e73ff
Author: Kevin Wolf <email address hidden>
Date:   Wed Apr 27 14:11:38 2016 +0200

    vvfat: Fix volume name assertion

    Commit d5941dd made the volume name configurable, but it didn't consider
    that the rw code compares the volume name string to assert that the
    first directory entry is the volume name. This made vvfat crash in rw
    mode.

    This fixes the assertion to compare with the configured volume name
    instead of a literal string.

    Cc: <email address hidden>
    Signed-off-by: Kevin Wolf <email address hidden>
    Reviewed-by: Markus Armbruster <email address hidden>
    Reviewed-by: Stefan Hajnoczi <email address hidden>

The fix is present since v2.6.0
As you're using v2.5.0, can you try with a newer QEMU version?

That means it is fixed in Yakkety and later, and not Broken in Trusty yet as the feature is not in.

Thank you Rolando for your report!
I think the issue is valid and a backport as SRU [1] possible.

I don't think you need to upload further Data, yet there is more you can help with.
For the SRU and testing it we will need some simplified steps to reproduce (and verify the fix).
Also see the Section SRU Template in [1].

So if you could add your steps to create the vfat image that then lets you trigger this that might help - I doubt it in this particular case, but sometimes suboptions on those steps are important so it is always better to get those from the bug reporter.

Also - if possible - it would be great if you could verify that those steps on Yakkety or later then succeed as expected since the upstream fix is already in there.

[1]: https://wiki.ubuntu.com/StableReleaseUpdates

Gah obviously for vvfat it isn't an image to be created at all.
So I thought steps to reproduce are:

1. get a guest that works (via uvtoools-libvirt or whatever you prever)
2. get the qemu commandline that it is started with, in my case:
   $ sudo kvm -m 1024 -drive file=/dev/sdb,format=raw,cache=none,index=0,media=disk
3. create a dir (can be empty) to share in vvfat mode
   $ mkdir /tmp/sharevvfat
   $ touch /tmp/sharevvfat/hostfoo
4. start your guest with the path as vvfat set to share (ro for now)
   Append the following to your qemu cmdline:
     -drive format=vvfat,file=fat:/tmp/sharevvfat/,if=virtio
   check the block device content by mounting it and verifyinf that "hostfoo" is there
5. shutdown the guest to retry rw
6. For rw append it as:
     -drive format=vvfat,file=fat:rw:/tmp/sharevvfat/,if=virtio

I have echoed some content into a file, and while the update policy isn't instand after my guest shut down I could access on the host what the guest put there.
All worked fine, but it seems it was already failing in the background on guest shutdown I see the failing assertion and the guest data is not written correctly to the Host.

Retrying on a newer qemu than Xenial confirmed that there the same case is working.

If there are no blockers uncovered on the way I will merge this with the ongoing qemu SRU.
That means that a test builds will soon be available in https://launchpad.net/~ci-train-ppa-service/+archive/ubuntu/2697

Added SRU Template and tested 1:2.5+dfsg-5ubuntu10.13 from the bileto ppa.

Bug is fixed, content can be written from the guest and is re-readable from there as well as on the Host.

That said pushed to the SRU unapproved queue.

Hi guys,

coming back from vacation last week, sorry for not replying before and.... tons of thanks for your prompt support and resolution!

BTW, by any chance, do you guys know what the status for a "bootsector=<path to file>" parameter for the VVFAT is?

Rolando

Hi,
I haven't touched on anything that would bring much more features to the vvfat code.
In general it is a helper to sync data, but it is brittle I'd not even so much like to see a bootsector support there. That I don't find anything doesn't mean there is nothing, if you know an upstream commit or discussion feel free to catch me, but if possible in a new bug or via IRC.

On this particular bug here we now wait for the SRU Team to accept that, the bug here on Lauchpad will get an update that it has to be verified to work (I'd totally appreciate your help there) and then it can be released into the stable release.

Sure, no problem Christian!

BTW, I just updated my system and got this qemu version:
>>> QEMU emulator version 2.5.0 (Debian 1:2.5+dfsg-5ubuntu10.11), Copyright (c) 2003-2008 Fabrice Bellard
but the issue is still there:
>>> qemu-system-x86_64: /build/qemu-iZpOAh/qemu-2.5+dfsg/block/vvfat.c:2290: commit_direntries: Assertion `!strncmp(s->directory.pointer, "QEMU", 4)' failed.
>>> Aborted (core dumped)

However, downloading and running the patched version you mentioned above from:
>>> https://launchpadlibrarian.net/316972847/qemu-system-x86_2.5+dfsg-5ubuntu10.13_amd64.deb
does work perfectly!

Thanks Christian and don't hesitate to let me know once it gets accepted and included. I'll "apt-get update" my system and let you know the outcome.

Again, thanks,
Rolando

Subscribing Marc so he can easily track once this SRU passes.

Hello Rolando, or anyone else affected,

Accepted qemu into xenial-proposed. The package will build now and be available at https://launchpad.net/ubuntu/+source/qemu/1:2.5+dfsg-5ubuntu10.13 in a few hours, and then in the -proposed repository.

Please help us by testing this new package.  See https://wiki.ubuntu.com/Testing/EnableProposed for documentation on how to enable and use -proposed.Your feedback will aid us getting this update out to other Ubuntu users.

If this package fixes the bug for you, please add a comment to this bug, mentioning the version of the package you tested, and change the tag from verification-needed to verification-done. If it does not fix the bug for you, please add a comment stating that, and change the tag to verification-failed.  In either case, details of your testing will help us make a better decision.

Further information regarding the verification process can be found at https://wiki.ubuntu.com/QATeam/PerformingSRUVerification .  Thank you in advance!

Hi Robie,

I think something is wrong with the build you mention.

Still can't install it by means of:
>>> apt-get -s install qemu-system-x86/xenial-proposed
>>> apt-get -s install qemu-system/xenial-proposed
or
>>> apt-get -s install qemu-kvm/xenial-proposed
but issuing a:
>>> wget https://launchpad.net/ubuntu/xenial/amd64/qemu-system-x86/1:2.5+dfsg-5ubuntu10.13
gives me, after renaming it, this error:
>>> ./patched-qemu 
>>> ./patched-qemu: line 1: syntax error near unexpected token `newline'
>>> ./patched-qemu: line 1: `<!DOCTYPE html>'
>>>
>>> ./patched-qemu --version
>>> ./patched-qemu: line 1: syntax error near unexpected token `newline'
>>> ./patched-qemu: line 1: `<!DOCTYPE html>'

Please note that I download *just* the qemu-system-x86 binary and nothing else than that.

HTH,
Rolando

Hi guys,

sorry, my bad! Downloaded the wrong file, the correct one is:
>>> http://launchpadlibrarian.net/318154621/qemu-system-x86_2.5+dfsg-5ubuntu10.13_amd64.deb

So, I checked it and, yes, it works fine!

I got this errors but I think they are correct as I'm just pointing to the new binary instead of re-installing all the files for the package:
>>> Failed to initialize module: /usr/lib/x86_64-linux-gnu/qemu/block-iscsi.so
>>> Note: only modules from the same build can be loaded.
>>> Failed to initialize module: /usr/lib/x86_64-linux-gnu/qemu/block-curl.so
>>> Note: only modules from the same build can be loaded.
>>> Failed to initialize module: /usr/lib/x86_64-linux-gnu/qemu/block-rbd.so
>>> Note: only modules from the same build can be loaded.
>>> Failed to initialize module: /usr/lib/x86_64-linux-gnu/qemu/block-dmg.so
>>> Note: only modules from the same build can be loaded.

So, again, thank you guys very much!

I might be opening a new bug to request the backport of the boot record code (I need to find out where it was though...)

Thanks,
Rolando


Hi guys,

unfortunatelly, I hit an issue with this patched version: there seems to be some issues, at least for LEAF (Linux Embedded Appliance Framework - https://sourceforge.net/projects/leaf).

Previous steps to reproduce (LEAF image creation):
	# This download is ~110M:
	wget https://downloads.sourceforge.net/project/leaf/Bering-uClibc/6.0.3/Bering-uClibc_6.0.3_x86_64_syslinux_serial115200.tar.gz
	qemu-img create -f qcow2 bering-own.qcow2 256M
	modprobe nbd
	qemu-nbd -c /dev/nbd0 bering-own.qcow2
	# Use fdisk to create a type c (FAT32 LBA) bootable partition like this:
	#	Device      Boot Start    End Sectors  Size Id Type
	#	/dev/nbd0p1 *     2048 524287  522240  255M  c W95 FAT32 (LBA)
	fdisk /dev/nbd0
	mkfs.vfat -n BERING -F 32 /dev/nbd0p1
	syslinux -i /dev/nbd0p1
	dd conv=notrunc bs=440 count=1 if=/usr/lib/SYSLINUX/mbr.bin of=/dev/nbd0
	mount /dev/nbd0p1 /mnt/
	tar -C /mnt -zxvf ./Bering-uClibc_6.0.3_x86_64_syslinux_serial115200.tar.gz

Not using the VVFAT it works OK:
	./patched-qemu-christian-OK/qemu-system-x86_64\
	 -nodefaults -nographic -localtime -enable-kvm -smp 1 -m 512 -serial stdio\
	 -drive if=ide,file=bering-own.qcow2\
	 -kernel /mnt/syslinux/linux -initrd /mnt/initrd.lrp\
	 -append 'rw root=/dev/ram0 console=ttyS0,115200n8 VERBOSE=1 PKGPATH=/dev/sda1:vfat LRP=root,license,local'
	# Type all this to shutdown LEAF:
	# root + [ENTER] + [ENTER] + q + poweroff

However, when using the VVFAT emulation:
	./patched-qemu-christian-OK/qemu-system-x86_64\
	 -nodefaults -nographic -localtime -enable-kvm -smp 1 -m 512 -serial stdio\
	 -drive if=ide,file=fat:rw:/mnt\
	 -kernel /mnt/syslinux/linux -initrd /mnt/initrd.lrp\
	 -append 'rw root=/dev/ram0 console=ttyS0,115200n8 VERBOSE=1 PKGPATH=/dev/sda1:vfat LRP=root,license,local'
LEAF displays these errors:
	LINUXRC: Mounted /dev/sda1 as vfat
	LINUXRC: Installing -  root: dev: /dev/sda1 mnt: /mnt1 t: vfat f: /mnt1/root.lrp /dev/sda1gunzip: invalid magic
	(cpt!)  license: dev: /dev/sda1 mnt: /mnt1 t: vfat f: /mnt1/license.lrp /dev/sda1gunzip: invalid magic
	(cpt!)  local: dev: /dev/sda1 mnt: /mnt1 t: vfat f: /mnt1/local.lrp /dev/sda1gunzip: unexpected end of file
	(cpt!)  configdb: dev: /dev/sda1 mnt: /mnt1 t: vfat f: /mnt1/configdb.lrp /dev/sda1gunzip: invalid magic
	(cpt!) - Finished.
	LINUXRC: Mounting squashfs with modules...
	mount: mounting /dev/loop0 on /lib/modules/4.4.61-x86_64 failed: Invalid argument
	LINUXRC: Squashfs mount failed!
	LINUXRC: loading modules from /etc/modules
	sed: /etc/modules: No such file or directory

To somehow debug it, I added the VVFAT as a second IDE HDD while using the qcow disk image as the primary boot drive:
	./patched-qemu-christian-OK/qemu-system-x86_64\
	 -nodefaults -nographic -localtime -enable-kvm -smp 1 -m 512 -serial stdio\
	 -drive if=ide,file=bering-own.qcow2,index=0\
	 -drive if=ide,file=fat:rw:/mnt\
	 -kernel /mnt/syslinux/linux -initrd /mnt/initrd.lrp\
	 -append 'rw root=/dev/ram0 console=ttyS0,115200n8 VERBOSE=1 PKGPATH=/dev/sda1:vfat LRP=root,license,local'
	# => root + {ENTER] + [ENTER] + q 
Then, get errors when mounting the VVFAT disk partition (but it gets mounted...) as well as when trying to display a sub-dir of it:
	firewall# mount /dev/sdb1 /mnt/
	[   29.728503] ata1.01: exception Emask 0x0 SAct 0x0 SErr 0x0 action 0x0
	[   29.730150] ata1.01: BMDMA stat 0x4
	[   29.730955] ata1.01: failed command: WRITE DMA
	[   29.731878] ata1.01: cmd ca/00:01:3f:00:00/00:00:00:00:00/f0 tag 0 dma 512 out
	[   29.731878]          res 41/04:01:3f:00:00/00:00:00:00:00/f0 Emask 0x1 (device error)
	[   29.734848] ata1.01: status: { DRDY ERR }
	[   29.735653] ata1.01: error: { ABRT }
	[   29.748597] ata1.01: exception Emask 0x0 SAct 0x0 SErr 0x0 action 0x0
	[   29.750128] ata1.01: BMDMA stat 0x4
	[   29.751237] ata1.01: failed command: WRITE DMA
	[   29.752674] ata1.01: cmd ca/00:01:3f:00:00/00:00:00:00:00/f0 tag 0 dma 512 out
	[   29.752674]          res 41/04:01:3f:00:00/00:00:00:00:00/f0 Emask 0x1 (device error)
	[   29.757221] ata1.01: status: { DRDY ERR }
	[   29.758383] ata1.01: error: { ABRT }
	[   29.770561] ata1.01: exception Emask 0x0 SAct 0x0 SErr 0x0 action 0x0
	[   29.772068] ata1.01: BMDMA stat 0x4
	[   29.772851] ata1.01: failed command: WRITE DMA
	[   29.773828] ata1.01: cmd ca/00:01:3f:00:00/00:00:00:00:00/f0 tag 0 dma 512 out
	[   29.773828]          res 41/04:01:3f:00:00/00:00:00:00:00/f0 Emask 0x1 (device error)
	[   29.778542] ata1.01: status: { DRDY ERR }
	[   29.779828] ata1.01: error: { ABRT }
	[   29.793604] ata1.01: exception Emask 0x0 SAct 0x0 SErr 0x0 action 0x0
	[   29.795799] ata1.01: BMDMA stat 0x4
	[   29.796860] ata1.01: failed command: WRITE DMA
	[   29.798271] ata1.01: cmd ca/00:01:3f:00:00/00:00:00:00:00/f0 tag 0 dma 512 out
	[   29.798271]          res 41/04:01:3f:00:00/00:00:00:00:00/f0 Emask 0x1 (device error)
	[   29.802941] ata1.01: status: { DRDY ERR }
	[   29.804105] ata1.01: error: { ABRT }
	[   29.817601] ata1.01: exception Emask 0x0 SAct 0x0 SErr 0x0 action 0x0
	[   29.819547] ata1.01: BMDMA stat 0x4
	[   29.820560] ata1.01: failed command: WRITE DMA
	[   29.821848] ata1.01: cmd ca/00:01:3f:00:00/00:00:00:00:00/f0 tag 0 dma 512 out
	[   29.821848]          res 41/04:01:3f:00:00/00:00:00:00:00/f0 Emask 0x1 (device error)
	[   29.826243] ata1.01: status: { DRDY ERR }
	[   29.827424] ata1.01: error: { ABRT }
	[   29.840597] ata1.01: exception Emask 0x0 SAct 0x0 SErr 0x0 action 0x0
	[   29.842000] ata1.01: BMDMA stat 0x4
	[   29.843059] ata1.01: failed command: WRITE DMA
	[   29.844294] ata1.01: cmd ca/00:01:3f:00:00/00:00:00:00:00/f0 tag 0 dma 512 out
	[   29.844294]          res 41/04:01:3f:00:00/00:00:00:00:00/f0 Emask 0x1 (device error)
	[   29.848549] ata1.01: status: { DRDY ERR }
	[   29.849667] ata1.01: error: { ABRT }
	[   29.852992] blk_update_request: I/O error, dev sdb, sector 63
	[   29.854540] Buffer I/O error on dev sdb1, logical block 0, lost sync page write
	firewall# 
	firewall# mount | grep sd
	/dev/sdb1 on /mnt type vfat (rw,relatime,fmask=0022,dmask=0022,codepage=866,iocharset=cp1251,shortname=mixed,errors=remount-ro)
	firewall#
	firewall# ls -d /mnt/s*
	/mnt/samba-swat.lrp      /mnt/shorwall6-lite.lrp  /mnt/ssh.lrp
	/mnt/samba-util.lrp      /mnt/shorwall6.lrp       /mnt/sshblack.lrp
	/mnt/samba.lrp           /mnt/siproxd.lrp         /mnt/sshd.lrp
	/mnt/screen.lrp          /mnt/smartctl.lrp        /mnt/sshkey.lrp
	/mnt/sensors.lrp         /mnt/smartd.lrp          /mnt/strongswan.lrp
	/mnt/ser2net.lrp         /mnt/snarf.lrp           /mnt/stunnel.lrp
	/mnt/serial.lrp          /mnt/snmpmibs.lrp        /mnt/syslinux
	/mnt/sftp.lrp            /mnt/snort.lrp           /mnt/sysstat.lrp
	/mnt/shorwall-lite.lrp   /mnt/speedtch.lrp
	/mnt/shorwall.lrp        /mnt/squid.lrp
	firewall# 
	firewall# ls -d /mnt/syslinux/s*
	[   33.622258] FAT-fs (sdb1): error, fat_get_cluster: invalid cluster chain (i_pos 0)
	[   33.625700] FAT-fs (sdb1): Filesystem has been set read-only
	ls: /mnt/syslinux/s4?-??�?.d|�: Input/output error
	[   33.629724] FAT-fs (sdb1): error, fat_get_cluster: invalid cluster chain (i_pos 0)
	ls: /mnt/syslinux/s�^�;??�.p�: Input/output error
	/mnt/syslinux/s?<?????.??o
	firewall# 

Please don't hesitate to ask me for further debugging, captures, logs or whatever. I'll be glad to have this solved.

Thanks in advance,
Rolando

I meant "I'll be glad to help to have this solved"  :-)

Just in case, this the output of a "dmesg" command:

firewall# dmesg 
[    0.000000] Linux version 4.4.61-x86_64 (kapeka@stalker) (gcc version 5.3.0 (GCC) ) #1 SMP Thu Apr 13 19:03:07 CEST 2017
[    0.000000] Command line: rw root=/dev/ram0 console=ttyS0,115200n8 VERBOSE=1 PKGPATH=/dev/sda1:vfat LRP=root,license,local
[    0.000000] KERNEL supported cpus:
[    0.000000]   Intel GenuineIntel
[    0.000000]   AMD AuthenticAMD
[    0.000000] x86/fpu: Legacy x87 FPU detected.
[    0.000000] x86/fpu: Using 'lazy' FPU context switches.
[    0.000000] e820: BIOS-provided physical RAM map:
[    0.000000] BIOS-e820: [mem 0x0000000000000000-0x000000000009fbff] usable
[    0.000000] BIOS-e820: [mem 0x000000000009fc00-0x000000000009ffff] reserved
[    0.000000] BIOS-e820: [mem 0x00000000000f0000-0x00000000000fffff] reserved
[    0.000000] BIOS-e820: [mem 0x0000000000100000-0x000000001ffdffff] usable
[    0.000000] BIOS-e820: [mem 0x000000001ffe0000-0x000000001fffffff] reserved
[    0.000000] BIOS-e820: [mem 0x00000000feffc000-0x00000000feffffff] reserved
[    0.000000] BIOS-e820: [mem 0x00000000fffc0000-0x00000000ffffffff] reserved
[    0.000000] NX (Execute Disable) protection: active
[    0.000000] SMBIOS 2.8 present.
[    0.000000] DMI: QEMU Standard PC (i440FX + PIIX, 1996), BIOS Ubuntu-1.8.2-1ubuntu1 04/01/2014
[    0.000000] Hypervisor detected: KVM
[    0.000000] e820: update [mem 0x00000000-0x00000fff] usable ==> reserved
[    0.000000] e820: remove [mem 0x000a0000-0x000fffff] usable
[    0.000000] e820: last_pfn = 0x1ffe0 max_arch_pfn = 0x400000000
[    0.000000] MTRR default type: write-back
[    0.000000] MTRR fixed ranges enabled:
[    0.000000]   00000-9FFFF write-back
[    0.000000]   A0000-BFFFF uncachable
[    0.000000]   C0000-FFFFF write-protect
[    0.000000] MTRR variable ranges enabled:
[    0.000000]   0 base 0080000000 mask FF80000000 uncachable
[    0.000000]   1 disabled
[    0.000000]   2 disabled
[    0.000000]   3 disabled
[    0.000000]   4 disabled
[    0.000000]   5 disabled
[    0.000000]   6 disabled
[    0.000000]   7 disabled
[    0.000000] x86/PAT: Configuration [0-7]: WB  WC  UC- UC  WB  WC  UC- WT  
[    0.000000] found SMP MP-table at [mem 0x000f6640-0x000f664f] mapped at [ffff8800000f6640]
[    0.000000] Scanning 1 areas for low memory corruption
[    0.000000] Base memory trampoline at [ffff880000099000] 99000 size 24576
[    0.000000] BRK [0x01c89000, 0x01c89fff] PGTABLE
[    0.000000] BRK [0x01c8a000, 0x01c8afff] PGTABLE
[    0.000000] BRK [0x01c8b000, 0x01c8bfff] PGTABLE
[    0.000000] BRK [0x01c8c000, 0x01c8cfff] PGTABLE
[    0.000000] RAMDISK: [mem 0x1ff57000-0x1ffdffff]
[    0.000000] ACPI: Early table checksum verification disabled
[    0.000000] ACPI: RSDP 0x00000000000F6460 000014 (v00 BOCHS )
[    0.000000] ACPI: RSDT 0x000000001FFE16FA 000034 (v01 BOCHS  BXPCRSDT 00000001 BXPC 00000001)
[    0.000000] ACPI: FACP 0x000000001FFE0C14 000074 (v01 BOCHS  BXPCFACP 00000001 BXPC 00000001)
[    0.000000] ACPI: DSDT 0x000000001FFE0040 000BD4 (v01 BOCHS  BXPCDSDT 00000001 BXPC 00000001)
[    0.000000] ACPI: FACS 0x000000001FFE0000 000040
[    0.000000] ACPI: SSDT 0x000000001FFE0C88 0009C2 (v01 BOCHS  BXPCSSDT 00000001 BXPC 00000001)
[    0.000000] ACPI: APIC 0x000000001FFE164A 000078 (v01 BOCHS  BXPCAPIC 00000001 BXPC 00000001)
[    0.000000] ACPI: HPET 0x000000001FFE16C2 000038 (v01 BOCHS  BXPCHPET 00000001 BXPC 00000001)
[    0.000000] ACPI: Local APIC address 0xfee00000
[    0.000000] kvm-clock: Using msrs 4b564d01 and 4b564d00
[    0.000000] kvm-clock: cpu 0, msr 0:1ff56001, primary cpu clock
[    0.000000] kvm-clock: using sched offset of 1738164004 cycles
[    0.000000] clocksource: kvm-clock: mask: 0xffffffffffffffff max_cycles: 0x1cd42e4dffb, max_idle_ns: 881590591483 ns
[    0.000000] Zone ranges:
[    0.000000]   DMA      [mem 0x0000000000001000-0x0000000000ffffff]
[    0.000000]   DMA32    [mem 0x0000000001000000-0x000000001ffdffff]
[    0.000000]   Normal   empty
[    0.000000] Movable zone start for each node
[    0.000000] Early memory node ranges
[    0.000000]   node   0: [mem 0x0000000000001000-0x000000000009efff]
[    0.000000]   node   0: [mem 0x0000000000100000-0x000000001ffdffff]
[    0.000000] Initmem setup node 0 [mem 0x0000000000001000-0x000000001ffdffff]
[    0.000000] On node 0 totalpages: 130942
[    0.000000]   DMA zone: 64 pages used for memmap
[    0.000000]   DMA zone: 21 pages reserved
[    0.000000]   DMA zone: 3998 pages, LIFO batch:0
[    0.000000]   DMA32 zone: 1984 pages used for memmap
[    0.000000]   DMA32 zone: 126944 pages, LIFO batch:31
[    0.000000] ACPI: PM-Timer IO Port: 0x608
[    0.000000] ACPI: Local APIC address 0xfee00000
[    0.000000] ACPI: LAPIC_NMI (acpi_id[0xff] dfl dfl lint[0x1])
[    0.000000] IOAPIC[0]: apic_id 0, version 17, address 0xfec00000, GSI 0-23
[    0.000000] ACPI: INT_SRC_OVR (bus 0 bus_irq 0 global_irq 2 dfl dfl)
[    0.000000] ACPI: INT_SRC_OVR (bus 0 bus_irq 5 global_irq 5 high level)
[    0.000000] ACPI: INT_SRC_OVR (bus 0 bus_irq 9 global_irq 9 high level)
[    0.000000] ACPI: INT_SRC_OVR (bus 0 bus_irq 10 global_irq 10 high level)
[    0.000000] ACPI: INT_SRC_OVR (bus 0 bus_irq 11 global_irq 11 high level)
[    0.000000] ACPI: IRQ0 used by override.
[    0.000000] ACPI: IRQ5 used by override.
[    0.000000] ACPI: IRQ9 used by override.
[    0.000000] ACPI: IRQ10 used by override.
[    0.000000] ACPI: IRQ11 used by override.
[    0.000000] Using ACPI (MADT) for SMP configuration information
[    0.000000] ACPI: HPET id: 0x8086a201 base: 0xfed00000
[    0.000000] smpboot: Allowing 1 CPUs, 0 hotplug CPUs
[    0.000000] e820: [mem 0x20000000-0xfeffbfff] available for PCI devices
[    0.000000] Booting paravirtualized kernel on KVM
[    0.000000] clocksource: refined-jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 1910969940391419 ns
[    0.000000] setup_percpu: NR_CPUS:8 nr_cpumask_bits:8 nr_cpu_ids:1 nr_node_ids:1
[    0.000000] PERCPU: Embedded 33 pages/cpu @ffff88001fc00000 s94232 r8192 d32744 u2097152
[    0.000000] pcpu-alloc: s94232 r8192 d32744 u2097152 alloc=1*2097152
[    0.000000] pcpu-alloc: [0] 0 
[    0.000000] KVM setup async PF for cpu 0
[    0.000000] kvm-stealtime: cpu 0, msr 1fc0d700
[    0.000000] Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 128873
[    0.000000] Kernel command line: rw root=/dev/ram0 console=ttyS0,115200n8 VERBOSE=1 PKGPATH=/dev/sda1:vfat LRP=root,license,local
[    0.000000] PID hash table entries: 2048 (order: 2, 16384 bytes)
[    0.000000] Dentry cache hash table entries: 65536 (order: 7, 524288 bytes)
[    0.000000] Inode-cache hash table entries: 32768 (order: 6, 262144 bytes)
[    0.000000] Memory: 501128K/523768K available (5882K kernel code, 793K rwdata, 2136K rodata, 1296K init, 472K bss, 22640K reserved, 0K cma-reserved)
[    0.000000] SLUB: HWalign=64, Order=0-3, MinObjects=0, CPUs=1, Nodes=1
[    0.000000] Hierarchical RCU implementation.
[    0.000000] 	Build-time adjustment of leaf fanout to 64.
[    0.000000] 	RCU restricting CPUs from NR_CPUS=8 to nr_cpu_ids=1.
[    0.000000] RCU: Adjusting geometry for rcu_fanout_leaf=64, nr_cpu_ids=1
[    0.000000] kmemleak: Kernel memory leak detector disabled
[    0.000000] NR_IRQS:4352 nr_irqs:256 16
[    0.000000] Console: colour *CGA 80x25
[    0.000000] console [ttyS0] enabled
[    0.000000] clocksource: hpet: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 19112604467 ns
[    0.000000] hpet clockevent registered
[    0.000000] tsc: Detected 2495.336 MHz processor
[    0.141367] Calibrating delay loop (skipped) preset value.. 4990.67 BogoMIPS (lpj=2495336)
[    0.143480] pid_max: default: 32768 minimum: 301
[    0.144654] ACPI: Core revision 20150930
[    0.147009] ACPI: 2 ACPI AML tables successfully acquired and loaded
[    0.148686] Mount-cache hash table entries: 1024 (order: 1, 8192 bytes)
[    0.150390] Mountpoint-cache hash table entries: 1024 (order: 1, 8192 bytes)
[    0.152365] mce: CPU supports 10 MCE banks
[    0.153443] Last level iTLB entries: 4KB 0, 2MB 0, 4MB 0
[    0.154711] Last level dTLB entries: 4KB 0, 2MB 0, 4MB 0, 1GB 0
[    0.169508] Freeing SMP alternatives memory: 24K (ffffffff81c0c000 - ffffffff81c12000)
[    0.179824] ftrace: allocating 23405 entries in 92 pages
[    0.220907] ..TIMER: vector=0x30 apic1=0 pin1=2 apic2=-1 pin2=-1
[    0.324183] smpboot: CPU0: AMD QEMU Virtual CPU version 2.5+ (family: 0x6, model: 0x6, stepping: 0x3)
[    0.326426] Performance Events: AMD PMU driver.
[    0.327521] ... version:                0
[    0.328385] ... bit width:              48
[    0.329333] ... generic registers:      4
[    0.330274] ... value mask:             0000ffffffffffff
[    0.331467] ... max period:             00007fffffffffff
[    0.332669] ... fixed-purpose events:   0
[    0.333608] ... event mask:             000000000000000f
[    0.335019] Huh? What family is it: 0x6?!
[    0.335899] MCE: In-kernel MCE decoding enabled.
[    0.336933] x86: Booted up 1 node, 1 CPUs
[    0.337849] smpboot: Total of 1 processors activated (4990.67 BogoMIPS)
[    0.340028] clocksource: jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 1911260446275000 ns
[    0.341990] futex hash table entries: 256 (order: 2, 16384 bytes)
[    0.343764] NET: Registered protocol family 16
[    0.344942] cpuidle: using governor ladder
[    0.345930] cpuidle: using governor menu
[    0.346934] ACPI: bus type PCI registered
[    0.347754] acpiphp: ACPI Hot Plug PCI Controller Driver version: 0.5
[    0.349264] PCI: Using configuration type 1 for base access
[    0.357481] ACPI: Added _OSI(Module Device)
[    0.358559] ACPI: Added _OSI(Processor Device)
[    0.359615] ACPI: Added _OSI(3.0 _SCP Extensions)
[    0.360729] ACPI: Added _OSI(Processor Aggregator Device)
[    0.363889] ACPI: Interpreter enabled
[    0.364757] ACPI: (supports S0 S5)
[    0.365560] ACPI: Using IOAPIC for interrupt routing
[    0.366603] PCI: Using host bridge windows from ACPI; if necessary, use "pci=nocrs" and report a bug
[    0.372906] ACPI: PCI Root Bridge [PCI0] (domain 0000 [bus 00-ff])
[    0.374375] acpi PNP0A03:00: _OSC: OS supports [ASPM ClockPM Segments MSI]
[    0.375982] acpi PNP0A03:00: _OSC failed (AE_NOT_FOUND); disabling ASPM
[    0.377539] acpi PNP0A03:00: fail to add MMCONFIG information, can't access extended PCI configuration space under this bridge.
[    0.380133] acpiphp: Slot [2] registered
[    0.381015] acpiphp: Slot [3] registered
[    0.381881] acpiphp: Slot [4] registered
[    0.382745] acpiphp: Slot [5] registered
[    0.383580] acpiphp: Slot [6] registered
[    0.384457] acpiphp: Slot [7] registered
[    0.385305] acpiphp: Slot [8] registered
[    0.386114] acpiphp: Slot [9] registered
[    0.386968] acpiphp: Slot [10] registered
[    0.387886] acpiphp: Slot [11] registered
[    0.388657] acpiphp: Slot [12] registered
[    0.389358] acpiphp: Slot [13] registered
[    0.390047] acpiphp: Slot [14] registered
[    0.390829] acpiphp: Slot [15] registered
[    0.391627] acpiphp: Slot [16] registered
[    0.392587] acpiphp: Slot [17] registered
[    0.393401] acpiphp: Slot [18] registered
[    0.394264] acpiphp: Slot [19] registered
[    0.395236] acpiphp: Slot [20] registered
[    0.396224] acpiphp: Slot [21] registered
[    0.397211] acpiphp: Slot [22] registered
[    0.398192] acpiphp: Slot [23] registered
[    0.399137] acpiphp: Slot [24] registered
[    0.400050] acpiphp: Slot [25] registered
[    0.400970] acpiphp: Slot [26] registered
[    0.401881] acpiphp: Slot [27] registered
[    0.402768] acpiphp: Slot [28] registered
[    0.403681] acpiphp: Slot [29] registered
[    0.404580] acpiphp: Slot [30] registered
[    0.405473] acpiphp: Slot [31] registered
[    0.406337] PCI host bridge to bus 0000:00
[    0.407192] pci_bus 0000:00: root bus resource [io  0x0000-0x0cf7 window]
[    0.408618] pci_bus 0000:00: root bus resource [io  0x0d00-0xffff window]
[    0.410013] pci_bus 0000:00: root bus resource [mem 0x000a0000-0x000bffff window]
[    0.411592] pci_bus 0000:00: root bus resource [mem 0x20000000-0xfebfffff window]
[    0.413192] pci_bus 0000:00: root bus resource [bus 00-ff]
[    0.414407] pci 0000:00:00.0: [8086:1237] type 00 class 0x060000
[    0.414995] pci 0000:00:01.0: [8086:7000] type 00 class 0x060100
[    0.415776] pci 0000:00:01.1: [8086:7010] type 00 class 0x010180
[    0.419084] pci 0000:00:01.1: reg 0x20: [io  0xc000-0xc00f]
[    0.420701] pci 0000:00:01.1: legacy IDE quirk: reg 0x10: [io  0x01f0-0x01f7]
[    0.422231] pci 0000:00:01.1: legacy IDE quirk: reg 0x14: [io  0x03f6]
[    0.423551] pci 0000:00:01.1: legacy IDE quirk: reg 0x18: [io  0x0170-0x0177]
[    0.425014] pci 0000:00:01.1: legacy IDE quirk: reg 0x1c: [io  0x0376]
[    0.426904] pci 0000:00:01.3: [8086:7113] type 00 class 0x068000
[    0.427506] pci 0000:00:01.3: quirk: [io  0x0600-0x063f] claimed by PIIX4 ACPI
[    0.429205] pci 0000:00:01.3: quirk: [io  0x0700-0x070f] claimed by PIIX4 SMB
[    0.431383] pci_bus 0000:00: on NUMA node 0
[    0.431998] ACPI: PCI Interrupt Link [LNKA] (IRQs 5 *10 11)
[    0.433451] ACPI: PCI Interrupt Link [LNKB] (IRQs 5 *10 11)
[    0.434961] ACPI: PCI Interrupt Link [LNKC] (IRQs 5 10 *11)
[    0.436408] ACPI: PCI Interrupt Link [LNKD] (IRQs 5 10 *11)
[    0.437849] ACPI: PCI Interrupt Link [LNKS] (IRQs *9)
[    0.439391] ACPI: Enabled 16 GPEs in block 00 to 0F
[    0.441194] vgaarb: loaded
[    0.441929] SCSI subsystem initialized
[    0.444424] libata version 3.00 loaded.
[    0.444434] ACPI: bus type USB registered
[    0.445371] usbcore: registered new interface driver usbfs
[    0.446559] usbcore: registered new interface driver hub
[    0.447869] usbcore: registered new device driver usb
[    0.449519] PCI: Using ACPI for IRQ routing
[    0.450515] PCI: pci_cache_line_size set to 64 bytes
[    0.450620] e820: reserve RAM buffer [mem 0x0009fc00-0x0009ffff]
[    0.450623] e820: reserve RAM buffer [mem 0x1ffe0000-0x1fffffff]
[    0.450886] HPET: 3 timers in total, 0 timers will be used for per-cpu timer
[    0.452438] hpet0: at MMIO 0xfed00000, IRQs 2, 8, 0
[    0.453672] hpet0: 3 comparators, 64-bit 100.000000 MHz counter
[    0.458315] amd_nb: Cannot enumerate AMD northbridges
[    0.459384] clocksource: Switched to clocksource kvm-clock
[    0.469963] pnp: PnP ACPI init
[    0.470948] pnp 00:00: Plug and Play ACPI device, IDs PNP0b00 (active)
[    0.471011] pnp 00:01: Plug and Play ACPI device, IDs PNP0303 (active)
[    0.471057] pnp 00:02: Plug and Play ACPI device, IDs PNP0f13 (active)
[    0.471104] pnp 00:03: [dma 2]
[    0.471127] pnp 00:03: Plug and Play ACPI device, IDs PNP0700 (active)
[    0.471247] pnp 00:04: Plug and Play ACPI device, IDs PNP0501 (active)
[    0.471623] pnp: PnP ACPI: found 5 devices
[    0.478666] clocksource: acpi_pm: mask: 0xffffff max_cycles: 0xffffff, max_idle_ns: 2085701024 ns
[    0.480456] pci_bus 0000:00: resource 4 [io  0x0000-0x0cf7 window]
[    0.480459] pci_bus 0000:00: resource 5 [io  0x0d00-0xffff window]
[    0.480462] pci_bus 0000:00: resource 6 [mem 0x000a0000-0x000bffff window]
[    0.480465] pci_bus 0000:00: resource 7 [mem 0x20000000-0xfebfffff window]
[    0.480504] NET: Registered protocol family 2
[    0.481558] TCP established hash table entries: 4096 (order: 3, 32768 bytes)
[    0.482995] TCP bind hash table entries: 4096 (order: 4, 65536 bytes)
[    0.484320] TCP: Hash tables configured (established 4096 bind 4096)
[    0.485643] UDP hash table entries: 256 (order: 1, 8192 bytes)
[    0.486837] UDP-Lite hash table entries: 256 (order: 1, 8192 bytes)
[    0.488150] NET: Registered protocol family 1
[    0.489056] pci 0000:00:00.0: Limiting direct PCI/PCI transfers
[    0.490267] pci 0000:00:01.0: PIIX3: Enabling Passive Release
[    0.491415] pci 0000:00:01.0: Activating ISA DMA hang workarounds
[    0.492618] PCI: CLS 0 bytes, default 64
[    0.493984] Trying to unpack rootfs image as initramfs...
[    0.505786] Freeing initrd memory: 548K (ffff88001ff57000 - ffff88001ffe0000)
[    0.507764] Scanning for low memory corruption every 60 seconds
[    0.509846] HugeTLB registered 2 MB page size, pre-allocated 0 pages
[    0.515088] squashfs: version 4.0 (2009/01/31) Phillip Lougher
[    0.517323] Block layer SCSI generic (bsg) driver version 0.4 loaded (major 252)
[    0.518948] io scheduler noop registered
[    0.519857] io scheduler cfq registered (default)
[    0.521025] pci_hotplug: PCI Hot Plug PCI Core version: 0.5
[    0.522267] pciehp: PCI Express Hot Plug Controller Driver version: 0.4
[    0.523824] input: Power Button as /devices/LNXSYSTM:00/LNXPWRBN:00/input/input0
[    0.525460] ACPI: Power Button [PWRF]
[    0.526373] GHES: HEST is not enabled!
[    0.527179] xenfs: not registering filesystem on non-xen platform
[    0.528525] Serial: 8250/16550 driver, 4 ports, IRQ sharing disabled
[    0.556061] 00:04: ttyS0 at I/O 0x3f8 (irq = 4, base_baud = 115200) is a 16550A
[    0.561195] brd: module loaded
[    0.564596] loop: module loaded
[    0.565283] skd:  v2.2.1-b0260 loaded
[    0.566074] mtip32xx Version 1.3.1
[    0.567154] zram: Added device: zram0
[    0.568295] ata_piix 0000:00:01.1: version 2.13
[    0.570121] FDC 0 is a S82078B
[    0.571426] scsi host0: ata_piix
[    0.572468] scsi host1: ata_piix
[    0.573183] ata1: PATA max MWDMA2 cmd 0x1f0 ctl 0x3f6 bmdma 0xc000 irq 14
[    0.574631] ata2: PATA max MWDMA2 cmd 0x170 ctl 0x376 bmdma 0xc008 irq 15
[    0.577554] ehci_hcd: USB 2.0 'Enhanced' Host Controller (EHCI) Driver
[    0.578977] ehci-pci: EHCI PCI platform driver
[    0.579915] ehci-platform: EHCI generic platform driver
[    0.580997] ohci_hcd: USB 1.1 'Open' Host Controller (OHCI) Driver
[    0.582272] ohci-pci: OHCI PCI platform driver
[    0.583263] uhci_hcd: USB Universal Host Controller Interface driver
[    0.584621] usbcore: registered new interface driver usb-storage
[    0.585861] i8042: PNP: PS/2 Controller [PNP0303:KBD,PNP0f13:MOU] at 0x60,0x64 irq 1,12
[    0.588420] serio: i8042 KBD port at 0x60,0x64 irq 1
[    0.589465] serio: i8042 AUX port at 0x60,0x64 irq 12
[    0.590662] input: PC Speaker as /devices/platform/pcspkr/input/input1
[    0.592062] rtc_cmos 00:00: RTC can wake from S4
[    0.593418] rtc_cmos 00:00: rtc core: registered rtc_cmos as rtc0
[    0.594894] rtc_cmos 00:00: alarms up to one day, 114 bytes nvram, hpet irqs
[    0.596327] sdhci: Secure Digital Host Controller Interface driver
[    0.597637] sdhci: Copyright(c) Pierre Ossman
[    0.598637] sdhci-pltfm: SDHCI platform and OF driver helper
[    0.599803] hidraw: raw HID events driver (C) Jiri Kosina
[    0.600931] usbcore: registered new interface driver usbhid
[    0.602007] usbhid: USB HID core driver
[    0.602915] NET: Registered protocol family 17
[    0.603818] Key type dns_resolver registered
[    0.605057] microcode: AMD CPU family 0x6 not supported
[    0.607119] input: AT Translated Set 2 keyboard as /devices/platform/i8042/serio0/input/input2
[    0.728744] ata1.00: ATA-7: QEMU HARDDISK, 2.5+, max UDMA/100
[    0.729972] ata1.00: 524288 sectors, multi 16: LBA48 
[    0.731471] ata1.01: ATA-7: QEMU HARDDISK, 2.5+, max UDMA/100
[    0.733434] ata1.01: 1032192 sectors, multi 16: LBA48 
[    0.736249] ata1.00: configured for MWDMA2
[    0.738486] ata1.01: configured for MWDMA2
[    0.739444] scsi 0:0:0:0: Direct-Access     ATA      QEMU HARDDISK    2.5+ PQ: 0 ANSI: 5
[    0.741982] sd 0:0:0:0: [sda] 524288 512-byte logical blocks: (268 MB/256 MiB)
[    0.743988] sd 0:0:0:0: [sda] Write Protect is off
[    0.745099] sd 0:0:0:0: [sda] Mode Sense: 00 3a 00 00
[    0.745113] sd 0:0:0:0: [sda] Write cache: enabled, read cache: enabled, doesn't support DPO or FUA
[    0.747723] scsi 0:0:1:0: Direct-Access     ATA      QEMU HARDDISK    2.5+ PQ: 0 ANSI: 5
[    0.750102] sd 0:0:1:0: [sdb] 1032192 512-byte logical blocks: (528 MB/504 MiB)
[    0.752090] sd 0:0:1:0: [sdb] Write Protect is off
[    0.753399] sd 0:0:1:0: [sdb] Mode Sense: 00 3a 00 00
[    0.753411] sd 0:0:1:0: [sdb] Write cache: enabled, read cache: enabled, doesn't support DPO or FUA
[    0.756666]  sda: sda1
[    0.757441] sd 0:0:0:0: [sda] Attached SCSI disk
[    0.758734]  sdb: sdb1
[    0.759388] sd 0:0:1:0: [sdb] Attached SCSI disk
[    0.762115] Freeing unused kernel memory: 1296K (ffffffff81ac8000 - ffffffff81c0c000)
[    0.764256] Write protecting the kernel read-only data: 10240k
[    0.766191] Freeing unused kernel memory: 248K (ffff8800015c2000 - ffff880001600000)
[    0.775481] Freeing unused kernel memory: 1960K (ffff880001816000 - ffff880001a00000)
[    0.810772] random: find: uninitialized urandom read (8 bytes read, 3 bits of entropy available)
[    0.831717] random: hotplug.sh: uninitialized urandom read (8 bytes read, 3 bits of entropy available)
[    0.833836] random: hotplug.sh: uninitialized urandom read (8 bytes read, 3 bits of entropy available)
[    0.835975] random: hotplug.sh: uninitialized urandom read (8 bytes read, 3 bits of entropy available)
[    0.838243] random: hotplug.sh: uninitialized urandom read (8 bytes read, 3 bits of entropy available)
[    0.840990] random: hotplug.sh: uninitialized urandom read (8 bytes read, 3 bits of entropy available)
[    0.843737] random: hotplug.sh: uninitialized urandom read (8 bytes read, 3 bits of entropy available)
[    0.846516] random: hotplug.sh: uninitialized urandom read (8 bytes read, 3 bits of entropy available)
[    0.849228] random: hotplug.sh: uninitialized urandom read (8 bytes read, 3 bits of entropy available)
[    0.852005] random: hotplug.sh: uninitialized urandom read (8 bytes read, 3 bits of entropy available)
[    1.510686] tsc: Refined TSC clocksource calibration: 2495.332 MHz
[    1.512361] clocksource: tsc: mask: 0xffffffffffffffff max_cycles: 0x23f8003d665, max_idle_ns: 440795255217 ns
[    4.158959] piix4_smbus 0000:00:01.3: SMBus Host Controller at 0x700, revision 0
[    4.838822] softdog: Software Watchdog Timer: 0.08 initialized. soft_noboot=0 soft_margin=60 sec soft_panic=0 (nowayout=0)
[    4.982043] NET: Registered protocol family 10
[    5.000259] 8021q: 802.1Q VLAN Support v1.8
[    5.038615] u32 classifier
[    5.039295]     Performance counters on
[    5.040081]     input device check on
[    5.040849]     Actions configured
[   36.744506] ata1.01: exception Emask 0x0 SAct 0x0 SErr 0x0 action 0x0
[   36.746008] ata1.01: BMDMA stat 0x4
[   36.746866] ata1.01: failed command: WRITE DMA
[   36.747807] ata1.01: cmd ca/00:01:3f:00:00/00:00:00:00:00/f0 tag 0 dma 512 out
[   36.747807]          res 41/04:01:3f:00:00/00:00:00:00:00/f0 Emask 0x1 (device error)
[   36.750913] ata1.01: status: { DRDY ERR }
[   36.751745] ata1.01: error: { ABRT }
[   36.753735] ata1.00: configured for MWDMA2
[   36.754238] ata1.01: configured for MWDMA2
[   36.754248] ata1: EH complete
[   36.764677] ata1.01: exception Emask 0x0 SAct 0x0 SErr 0x0 action 0x0
[   36.766125] ata1.01: BMDMA stat 0x4
[   36.767184] ata1.01: failed command: WRITE DMA
[   36.768635] ata1.01: cmd ca/00:01:3f:00:00/00:00:00:00:00/f0 tag 0 dma 512 out
[   36.768635]          res 41/04:01:3f:00:00/00:00:00:00:00/f0 Emask 0x1 (device error)
[   36.773205] ata1.01: status: { DRDY ERR }
[   36.774506] ata1.01: error: { ABRT }
[   36.776598] ata1.00: configured for MWDMA2
[   36.777102] ata1.01: configured for MWDMA2
[   36.777112] ata1: EH complete
[   36.787678] ata1.01: exception Emask 0x0 SAct 0x0 SErr 0x0 action 0x0
[   36.789165] ata1.01: BMDMA stat 0x4
[   36.790130] ata1.01: failed command: WRITE DMA
[   36.791582] ata1.01: cmd ca/00:01:3f:00:00/00:00:00:00:00/f0 tag 0 dma 512 out
[   36.791582]          res 41/04:01:3f:00:00/00:00:00:00:00/f0 Emask 0x1 (device error)
[   36.796144] ata1.01: status: { DRDY ERR }
[   36.797466] ata1.01: error: { ABRT }
[   36.799712] ata1.00: configured for MWDMA2
[   36.800214] ata1.01: configured for MWDMA2
[   36.800223] ata1: EH complete
[   36.810702] ata1.01: exception Emask 0x0 SAct 0x0 SErr 0x0 action 0x0
[   36.812454] ata1.01: BMDMA stat 0x4
[   36.813437] ata1.01: failed command: WRITE DMA
[   36.814777] ata1.01: cmd ca/00:01:3f:00:00/00:00:00:00:00/f0 tag 0 dma 512 out
[   36.814777]          res 41/04:01:3f:00:00/00:00:00:00:00/f0 Emask 0x1 (device error)
[   36.820131] ata1.01: status: { DRDY ERR }
[   36.821591] ata1.01: error: { ABRT }
[   36.824043] ata1.00: configured for MWDMA2
[   36.824600] ata1.01: configured for MWDMA2
[   36.824610] ata1: EH complete
[   36.834702] ata1.01: exception Emask 0x0 SAct 0x0 SErr 0x0 action 0x0
[   36.836377] ata1.01: BMDMA stat 0x4
[   36.836956] ata1.01: failed command: WRITE DMA
[   36.838085] ata1.01: cmd ca/00:01:3f:00:00/00:00:00:00:00/f0 tag 0 dma 512 out
[   36.838085]          res 41/04:01:3f:00:00/00:00:00:00:00/f0 Emask 0x1 (device error)
[   36.843086] ata1.01: status: { DRDY ERR }
[   36.844550] ata1.01: error: { ABRT }
[   36.847300] ata1.00: configured for MWDMA2
[   36.847863] ata1.01: configured for MWDMA2
[   36.847873] ata1: EH complete
[   36.857675] ata1.01: exception Emask 0x0 SAct 0x0 SErr 0x0 action 0x0
[   36.859795] ata1.01: BMDMA stat 0x4
[   36.861107] ata1.01: failed command: WRITE DMA
[   36.862769] ata1.01: cmd ca/00:01:3f:00:00/00:00:00:00:00/f0 tag 0 dma 512 out
[   36.862769]          res 41/04:01:3f:00:00/00:00:00:00:00/f0 Emask 0x1 (device error)
[   36.868085] ata1.01: status: { DRDY ERR }
[   36.869334] ata1.01: error: { ABRT }
[   36.871646] ata1.00: configured for MWDMA2
[   36.872151] ata1.01: configured for MWDMA2
[   36.872166] sd 0:0:1:0: [sdb] tag#0 FAILED Result: hostbyte=DID_OK driverbyte=DRIVER_SENSE
[   36.872170] sd 0:0:1:0: [sdb] tag#0 Sense Key : Illegal Request [current] [descriptor] 
[   36.872174] sd 0:0:1:0: [sdb] tag#0 Add. Sense: Unaligned write command
[   36.872178] sd 0:0:1:0: [sdb] tag#0 CDB: Write(10) 2a 00 00 00 00 3f 00 00 01 00
[   36.872181] blk_update_request: I/O error, dev sdb, sector 63
[   36.873362] Buffer I/O error on dev sdb1, logical block 0, lost sync page write
[   36.875082] ata1: EH complete
[   36.875499] sda: detected capacity change from 0 to 268435456
[   36.875572] sda: detected capacity change from 0 to 268435456
[   78.637915] FAT-fs (sdb1): error, fat_get_cluster: invalid cluster chain (i_pos 0)
[   78.641513] FAT-fs (sdb1): Filesystem has been set read-only
[   78.645753] FAT-fs (sdb1): error, fat_get_cluster: invalid cluster chain (i_pos 0)
firewall# 


Hi Rolando,
there are further changes in this build - we need to exclude that you are seeing this just due to only downloading the .deb file instead of enabling proposed to gain all required dependencies.

You can instead of an full "apt upgrade" also run rather selective upgrades.
I'd recommend
1. enabling proposed
2. call apt upgrade to check what is available but then abort
3. call apt install "<qemu packages you saw in step #2"
   # this will pull in all dependencies

Hi Rolando,
we really should stick to here verify the issue that we fixed (the vvfat rw fail) and after you gave me a 50%-heartache :-) I verified proposed on my own now.

It just works via
1. echo "deb http://archive.ubuntu.com/ubuntu/ xenial-proposed restricted main multiverse universe" >> /etc/apt/sources.list
2. apt update
3. apt install qemu-block-extra qemu-kvm qemu-system-common qemu-system-x86 qemu-utils

Now (re)-start your vvfat guest and it will work to write to the vvfat disk.
It did so for me at least.


I read through the issue you are seeing now and that is IMHO as a TL;DR saying "the vvfat emulation of a directory is not matching mounting it directly in the guest.
Am I right with that the summary of above is
1. create empty fat (not vvfat) image bering-own.qcow2
compare running
a) mount image to /mnt and append it as vvfat to the guest
vs
b) pass the qcow file itself as a drive to the guest
If I'm correct in reading what you do that is a totally different case.
If you look at the code [1] and some doc [2]+[3] you'll see that this driver is very restricted.
I'd never use it (or have seen it used) as root file system, not even for something critical other than simple data sharing between win guests and the host.
Quoting:
What you should never do:
- use non-ASCII filenames ;
- use "-snapshot" together with ":rw:" ;
- expect it to work when loadvm’ing ;
- write to the FAT directory on the host system while accessing it with the guest system.

There are slight improvements in [4], but also see the discussion [3] which ended as Won't Fix.

Quoting from [3] is good as well: "vfat is a last-resort quick-n-dirty fix for a problem when you have a guest which doesn't have any other ways to communicate except of a fat image (read: a floppy).  In all other cases just don't use it."

[1]: https://github.com/qemu/qemu/blob/master/block/vvfat.c
[2]: https://en.wikibooks.org/wiki/QEMU/Devices/Storage
[3]: https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=419929
[4]: https://bugs.launchpad.net/qemu/+bug/1599539


All that said for the initially reported issue I can confirm that the bug is fixed and verified in proposed. Further insufficiencies of vfat would be another bug, but actually more upstream development work. If you open a new one I'm happy to discuss, but unlikely will find the time to do the related dev work.

Hi Christian,

Ok, understood. And, yes, you are correct: basically I create a qcow image file and then:
- Bering works fine when passing qemu the qcow image file to be used as the HDD
- Bering doesn't work when mounting the same qcow image file and then launching qemu to access those same files from the mount point.

Please note that the issue happens while meeting all this conditions (already known by me):
  What you should never do:
  - use non-ASCII filenames ;
  - use "-snapshot" together with ":rw:" ;
  - expect it to work when loadvm’ing ;
  - write to the FAT directory on the host system while accessing it with the guest system.

Anyways, will open a new bug for this LEAF/Bering issue but, I agree with you, in that this feature should be used with caution, at least for now, as it seems to be still quite buggy.

Thanks Christian!

This bug was fixed in the package qemu - 1:2.5+dfsg-5ubuntu10.13

---------------
qemu (1:2.5+dfsg-5ubuntu10.13) xenial; urgency=medium

  * debian/patches/ubuntu/vvfat-fix-volume-name-assertion.patch:
    Fix the volume name assertion in vvfat rw mode (LP: #1684239)

qemu (1:2.5+dfsg-5ubuntu10.12) xenial; urgency=medium

  * debian/patches/ubuntu/bug-1656112-POWER8NVL-[12]-*.patch:
    Add PowerISA 2.07 compatibility mode to fix execution on POWER8NVL
    processors such as in S822LC (8335-GTB) machines (LP: #1656112)

 -- Christian Ehrhardt <email address hidden>  Tue, 25 Apr 2017 13:58:10 +0200

The verification of the Stable Release Update for qemu has completed successfully and the package has now been released to -updates.  Subsequently, the Ubuntu Stable Release Updates Team is being unsubscribed and will not receive messages about this bug report.  In the event that you encounter a regression using the package from -updates please report a new bug using ubuntu-bug and tag the bug report regression-update so we can easily find any regressions.

Thank you all very much guys!

I'm on a business travel but will install update it as soon as I get back home.

Hi Christian,

as stated above, found other bugs but as you said they seem to not to be related to this one so please feel free to close it.

Thanks,
Rolando.

